---
title: 一段有意思的代码
date: 2022-02-10 23:22:43
tags:
- CSAPP
categories:
- CSAPP

---

今天学习到了一段非常amazing的代码，我想分享出来。
``` c
int div16(int x) {
    /* Compute bias to be either 0 (x >= 0) or 15 (x < 0) */
    int bias = (x >> 31) & 0xF;
    return (x + bias) >> 4;
}
```
这段代码的作用是返回 x 除以 16 的结果。当除数为 2 的幂时，我们可以考虑用算数右移来替代整数除法，然而在结果需要保留为整数时，整数的除法是向零取整，然而算数右移只能向下取整，所以当 x 为负数的时候需要加上一段偏移才能使得结果正确，这个偏移量就是除数 -1，如上代码是除以 16 ，则偏移量为 15。x 为 非负数时偏移量为 0， x 为负数时偏移量为 15。

tips: 
+ 算数右移是根据高位的 0 或 1 补位 0 或 1，而逻辑右移是直接补位 0。
+ ( x < 0, y > 0 时) x / y 向上取整 == (x + y - 1) / y 向下取整。
